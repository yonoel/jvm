# class类文件结构

代码编译的结果是从本地机器码变成了字节码，是存储格式发展的一小步，却是编程语言的一大步。

## 概述

机器只认识1和0，目前将编写的程序编译成二进制本地机器码已经不再是唯一的选择，越来越多的语言选择了与操作系统和机器指令集无关的，平台中立的格式作为编译后的存储格式。

## 无关性的基石

字节码是各种不同平台的虚拟机和所有平台的统一使用的程序存储格式，这是构成平台无关性的基石。

Java虚拟机不和包括Java在内的语言绑定，只与'class'文件这种特殊的二进制文件格式关联。

## Class类文件的结构

注意：任何一个class文件都对应着唯一一个类或接口的定义信息，但是反过来，类或接口并不一定得在在class文件里定义，也可以通过类加载器直接生成。

class文件格式采用一种类似于C语言结构体的伪结构来存储数据，只有两种数据类型
1.  无符号数，基本的数据类型，以u1,u2,u4,u8来表示1，2，4，8个字节的无符号数，用来描述数字，索引引用，数量值，或者字符串
2.  表，多个无符号数或其他表组成的复合数据类型，习惯性的以"_info"结尾，用于描述有层次关系的复合结构的数据，class本质上就是张表

无论是无符号数还是表，当需要描述同一类型但数量不定的多个数据时，会使用一个前置的容量计数器加若干个数据项的形式，这被称为集合。

## 魔法数和版本号

前4个字节是魔法数表明class文件，5，6字节是次版本号（minor version），7，8字节是主版本号major version

### 常量池

紧接着就是class文件里的常量池，是class文件里第一个出现的表类型数据项目

一般是一个集合，计数从1开始。

存放两大类常量：
+   字面量
+   符号引用
    +   类和接口的全限定名
    +   字段的名称和描述符
    +   方法的名称和描述符

### 访问标志

紧接着两个字节表示访问标志，用于识别一些类和接口的访问信息。

### 类索引，父类索引，接口索引集合

由这三项来确定类的继承关系

### 字段表集合

用于描述接口或类中声明的变量。包括类级变量以及实例变量，不包括方法内的局部变量。

### 方法表集合

方法里面的java代码，经过编译后成为字节码质量后，存放在属性表集合中一个名为"Code"的属性里面

### 属性表集合

用于描述特殊场景专有的信息

比如Code。。。。

## 字节码指令



